<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs") %>

    <body>
        <%- include("../partials/nav.ejs") %>
            <section id="page-title">
                <h1>Edit your itinerary</h1>
                <div class="user-actions">
                    <a href="/itineraries/<%= itinerary._id%>" class="control-button">Go back</a>
                </div>
            </section>
            <main class="page-content form-page">
                <form id="uploadForm" action="/itineraries/<%= itinerary._id%>?_method=PUT" method="POST">
                    <div>
                        <label for="destination">Destination</label>
                        <input type="text" name="name" id="name" required value="<%=itinerary.destination%>">
                    </div>
                    <div>
                        <label for="continent">Continent</label>
                        <input type="text" name="continent" id="continent" required value="<%=itinerary.continent%>">
                    </div>
                    <div>
                        <label for="timeOfYear">Time of year</label>
                        <input type="text" name="timeOfYear" id="timeOfYear" required value="<%=itinerary.timeOfYear%>">
                    </div>
                    <div>
                        <label for="morning">Morning</label>
                        <textarea id="morning" name="morning" required><%=itinerary.morning%></textarea>
                    </div>
                    <div>
                        <label for="afternoon">Afternoon</label>
                        <textarea id="afternoon" name="afternoon" required><%=itinerary.afternoon%></textarea>
                    </div>
                    <div>
                        <label for="evening">Evening</label>
                        <textarea id="evening" name="evening" required><%=itinerary.evening%></textarea>
                    </div>
                    <div class="file-upload-wrapper">
                        <input type="file" name="upload-files" id="image" accept="image/*" multiple>
                        <label for="image" class="custom-file-upload">
                            <span class="file-name" id="file-name"></span>
                        </label>
                    </div>
                    <div id="uploadMessages"></div>
                    <button type="submit" class="page-button">Update</button>
                </form>
            </main>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const fileInput = document.getElementById('image')
                    const fileNameDisplay = document.getElementById('file-name')
                    const label = document.querySelector('.custom-file-upload')

                    if (!fileInput) return

                    fileInput.addEventListener('change', function () {
                        if (this.files && this.files.length > 0) {
                            const fileNames = Array.from(this.files).map(file => file.name).join(', ')
                            fileNameDisplay.textContent = fileNames
                            label.classList.add('has-file')
                        } else {
                            fileNameDisplay.textContent = 'No files chosen'
                            label.classList.remove('has-file')
                        }

                        cloudinaryUpload(this.files, 'images', true)
                    })
                })
            </script> 
    </body>

</html>