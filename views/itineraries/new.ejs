<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs") %>

    <body>
        <%- include("../partials/nav.ejs") %>
            <section id="page-title">
                <h1>Create new itinerary</h1>
                <div class="user-actions">
                    <a href="/itineraries" class="control-button">Go back</a>
                </div>
            </section>
            <main class="page-content form-page">
                <% if (message && message.type==='error' ) { %>
                    <div class="flash flash-error">
                        <%= message.text %>
                    </div>
                    <% } %>
                        <form action="/itineraries" method="POST">
                            <div>
                                <label for="destination">Destination</label>
                                <input type="text" name="destination" id="name" required
                                    value="<%= formData.destination || '' %>">
                            </div>
                            <div>
                                <label for="continent">Continent</label>
                                <input type="text" name="continent" id="continent" required
                                    value="<%= formData.continent || '' %>">
                            </div>
                            <div>
                                <label for="timeOfYear">Time of year</label>
                                <input type="text" name="timeOfYear" id="timeOfYear" required
                                    value="<%= formData.timeOfYear || '' %>">
                            </div>
                            <div>
                                <label for="morning">Morning</label>
                                <textarea id="morning" name="morning" required><%= formData.morning || '' %></textarea>
                            </div>
                            <div>
                                <label for="afternoon">Afternoon</label>
                                <textarea id="afternoon" name="afternoon"
                                    required><%= formData.afternoon || '' %></textarea>
                            </div>
                            <div>
                                <label for="evening">Evening</label>
                                <textarea id="evening" name="evening" required><%= formData.evening || '' %></textarea>
                            </div>
                            <div class="file-upload-wrapper">
                                <input type="file" name="upload-files" id="image" accept="image/*" multiple>
                                <label for="image" class="custom-file-upload">
                                    <span class="file-name" id="file-name"></span>
                                </label>
                            </div>
                            <div id="uploadMessages"></div>
                            <button type="submit" class="page-button">Publish</button>
                        </form>
            </main>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const fileInput = document.getElementById('image')
                    const fileNameDisplay = document.getElementById('file-name')
                    const label = document.querySelector('.custom-file-upload')

                    if (!fileInput) return

                    fileInput.addEventListener('change', function () {
                        if (this.files && this.files.length > 0) {
                            const fileNames = Array.from(this.files).map(file => file.name).join(', ')
                            fileNameDisplay.textContent = fileNames
                            label.classList.add('has-file')
                        } else {
                            fileNameDisplay.textContent = 'No files chosen'
                            label.classList.remove('has-file')
                        }

                        if (typeof cloudinaryUpload === 'function') {
                            cloudinaryUpload(this.files)
                        }
                    })
                })
            </script>
    </body>

</html>