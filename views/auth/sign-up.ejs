<!DOCTYPE html>
<html lang="en">
<% include("../partials/head.ejs") %>

    <body>
        <%- include("../partials/nav.ejs") %>
            <section id="page-title">
                <h1>Create your account</h1>
            </section>
            <main class="page-content form-page">
                <% if (message && message.type==='error' ) { %>
                    <div class="flash flash-error">
                        <%= message.text %>
                    </div>
                    <% } %>
                        <form id="uploadForm" action="/auth/sign-up" method="POST">
                            <table>
                                <tr>
                                    <td><label for="username">Username:</label></td>
                                    <td><input type="text" name="username" id="username" /></td>
                                </tr>
                                <tr>
                                    <td><label for="password">Password:</label></td>
                                    <td><input type="password" name="password" id="password" /></td>
                                </tr>
                                <tr>
                                    <td><label for="confirmPassword">Confirm Password:</label></td>
                                    <td><input type="password" name="confirmPassword" id="confirmPassword" /></td>
                                </tr>
                                <tr>
                                    <td><label for="profileImage">Upload image:</label></td>
                                    <td>
                                        <div class="file-upload-wrapper">
                                            <input type="file" name="upload-files" id="image" accept="image/*">
                                            <label for="image" class="custom-file-upload">
                                                <span class="file-name" id="file-name"></span>
                                            </label>
                                        </div>
                                        <div id="uploadMessages"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="text-align: center;">
                                        <button type="submit" class="page-button">Sign up</button>
                                    </td>
                                </tr>
                            </table>
                        </form>

                        <p> Already have an account?
                            <a href="/auth/sign-in" class="page-link">Sign in</a>
                        </p>
            </main>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const fileInput = document.getElementById('image')
                    const fileNameDisplay = document.getElementById('file-name')
                    const label = document.querySelector('.custom-file-upload')

                    if (!fileInput) return

                    fileInput.addEventListener('change', function () {
                        if (this.files && this.files.length > 0) {
                            const fileNames = Array.from(this.files).map(file => file.name).join(', ')
                            fileNameDisplay.textContent = fileNames
                            label.classList.add('has-file')
                        } else {
                            fileNameDisplay.textContent = 'No files chosen'
                            label.classList.remove('has-file')
                        }

                        if (typeof cloudinaryUpload === 'function') {
                            cloudinaryUpload(this.files, 'profileImage')
                        }
                    })
                })
            </script>
    </body>

</html>